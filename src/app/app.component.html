<!-- Navigation for authenticated pages -->
<div *ngIf="isLoggedIn && !isLandingPage">
  <mat-toolbar color="primary" class="app-toolbar">
    <button mat-icon-button (click)="sidenav.toggle()" class="menu-button">
      <mat-icon>menu</mat-icon>
    </button>
    
    <span class="app-title">
      <mat-icon class="title-icon">receipt</mat-icon>
      {{ title }}
    </span>
    
    <span class="spacer"></span>
    
    <div class="toolbar-actions">
      <button mat-icon-button [routerLink]="['/profile']" matTooltip="Profile">
        <mat-icon>account_circle</mat-icon>
      </button>
      <button mat-icon-button (click)="logout()" matTooltip="Logout">
        <mat-icon>logout</mat-icon>
      </button>
      <button mat-icon-button (click)="clearData()" matTooltip="Clear Data (Debug)" *ngIf="!isLoggedIn">
        <mat-icon>clear_all</mat-icon>
      </button>
    </div>
  </mat-toolbar>

  <mat-sidenav-container class="sidenav-container">
    <!-- Desktop Sidebar -->
    <mat-sidenav #sidenav [mode]="isMobile ? 'over' : 'side'" [opened]="!isMobile" class="sidenav">
      <mat-nav-list>
        <a mat-list-item [routerLink]="['/dashboard']" routerLinkActive="active-link" (click)="closeSidenavOnMobile()">
          <mat-icon matListItemIcon>dashboard</mat-icon>
          <span matListItemTitle>Dashboard</span>
        </a>
        
        <a mat-list-item [routerLink]="['/scan']" routerLinkActive="active-link" (click)="closeSidenavOnMobile()">
          <mat-icon matListItemIcon>camera_alt</mat-icon>
          <span matListItemTitle>Scan Receipt</span>
        </a>
        
        <a mat-list-item [routerLink]="['/history']" routerLinkActive="active-link" (click)="closeSidenavOnMobile()">
          <mat-icon matListItemIcon>history</mat-icon>
          <span matListItemTitle>Receipt History</span>
        </a>
        
        <a mat-list-item [routerLink]="['/analytics']" routerLinkActive="active-link" (click)="closeSidenavOnMobile()">
          <mat-icon matListItemIcon>analytics</mat-icon>
          <span matListItemTitle>Analytics</span>
        </a>
        
        <a mat-list-item [routerLink]="['/profile']" routerLinkActive="active-link" (click)="closeSidenavOnMobile()">
          <mat-icon matListItemIcon>person</mat-icon>
          <span matListItemTitle>Profile</span>
        </a>
      </mat-nav-list>
    </mat-sidenav>
    
    <mat-sidenav-content class="sidenav-content">
      <!-- Mobile Page Title -->
      <div class="mobile-page-title" *ngIf="isMobile && currentPageTitle">
        <h2>{{ currentPageTitle }}</h2>
      </div>
      
      <div class="content-wrapper">
        <router-outlet></router-outlet>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>

  <!-- Mobile Bottom Navigation -->
  <div class="mobile-bottom-nav" *ngIf="isMobile">
    <a mat-button 
       [routerLink]="['/dashboard']" 
       routerLinkActive="active-mobile-nav"
       (click)="setCurrentPageTitle('Dashboard')"
       class="mobile-nav-item">
      <mat-icon>dashboard</mat-icon>
    </a>
    
    <a mat-button 
       [routerLink]="['/scan']" 
       routerLinkActive="active-mobile-nav"
       (click)="setCurrentPageTitle('Scan Receipt')"
       class="mobile-nav-item">
      <mat-icon>camera_alt</mat-icon>
    </a>
    
    <a mat-button 
       [routerLink]="['/history']" 
       routerLinkActive="active-mobile-nav"
       (click)="setCurrentPageTitle('Receipt History')"
       class="mobile-nav-item">
      <mat-icon>history</mat-icon>
    </a>
    
    <a mat-button 
       [routerLink]="['/analytics']" 
       routerLinkActive="active-mobile-nav"
       (click)="setCurrentPageTitle('Analytics')"
       class="mobile-nav-item">
      <mat-icon>analytics</mat-icon>
    </a>
    
    <a mat-button 
       [routerLink]="['/profile']" 
       routerLinkActive="active-mobile-nav"
       (click)="setCurrentPageTitle('Profile')"
       class="mobile-nav-item">
      <mat-icon>person</mat-icon>
    </a>
  </div>
</div>

<!-- Navigation for non-authenticated pages (except landing) -->
<div *ngIf="!isLoggedIn && !isLandingPage">
  <mat-toolbar color="primary" class="app-toolbar">
    <span class="app-title">
      <mat-icon class="title-icon">receipt</mat-icon>
      {{ title }}
    </span>
    
    <span class="spacer"></span>
    
    <div class="toolbar-actions">
      <button mat-button [routerLink]="['/login']">Login</button>
      <button mat-raised-button color="accent" [routerLink]="['/register']">Sign Up</button>
    </div>
  </mat-toolbar>

  <div class="content-wrapper">
    <router-outlet></router-outlet>
  </div>
</div>

<!-- Full page content for landing, login, and register pages -->
<div *ngIf="!isLoggedIn && isLandingPage" class="full-page-content">
  <router-outlet></router-outlet>
</div>
